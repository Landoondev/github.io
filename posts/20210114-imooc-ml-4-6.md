# 4-6 网格搜索与 k 近邻算法中的更多超参数


```python
import numpy as np
from sklearn import datasets
```


```python
digits = datasets.load_digits()
X = digits.data
y = digits.target
```


```python
from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=666)
```


```python
from sklearn.neighbors import KNeighborsClassifier

knn_clf = KNeighborsClassifier(n_neighbors=4, weights="uniform")
knn_clf.fit(X_train, y_train)
knn_clf.score(X_test, y_test)
```




    0.9916666666666667



## Grid Search


```python
# 定义搜索的参数

param_grid = [
    {
        'weights': ['uniform'], 
        'n_neighbors': [i for i in range(1, 11)]
    },
    {
        'weights': ['distance'],
        'n_neighbors': [i for i in range(1, 11)], 
        'p': [i for i in range(1, 6)]
    }
]
```


```python
knn_clf = KNeighborsClassifier()
```


```python
# CV 是交叉验证的意思
from sklearn.model_selection import GridSearchCV

grid_search = GridSearchCV(knn_clf, param_grid)
```


```python
%%time
grid_search.fit(X_train, y_train)
```

    CPU times: user 44.9 s, sys: 47.9 ms, total: 45 s
    Wall time: 45.2 s





    GridSearchCV(estimator=KNeighborsClassifier(),
                 param_grid=[{'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                              'weights': ['uniform']},
                             {'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                              'p': [1, 2, 3, 4, 5], 'weights': ['distance']}])



我感觉是错误的 ❌


```python
grid_search.best_estimator_
```




    KNeighborsClassifier(n_neighbors=1)




```python
# p 参数呢？？？
grid_search.best_params_
```




    {'n_neighbors': 1, 'weights': 'uniform'}




```python
grid_search.best_score_
```




    0.9860820751064653




```python
# 使用搜索到的参数
knn_clf = grid_search.best_estimator_
```


```python
knn_clf.score(X_test, y_test)
```




    0.9833333333333333




```python
%%time
grid_search = GridSearchCV(knn_clf, param_grid, n_jobs=-1, verbose=2) # n_jobs 计算机核数， -1使用全部的核 
                                                                      # verbose 搜索过程输出一些信息,值越大信息越详细
    
grid_search.fit(X_train, y_train)
```

    Fitting 5 folds for each of 60 candidates, totalling 300 fits


    [Parallel(n_jobs=-1)]: Using backend LokyBackend with 4 concurrent workers.
    [Parallel(n_jobs=-1)]: Done  34 tasks      | elapsed:    4.2s
    [Parallel(n_jobs=-1)]: Done 246 tasks      | elapsed:   17.8s


    CPU times: user 636 ms, sys: 112 ms, total: 747 ms
    Wall time: 22.6 s


    [Parallel(n_jobs=-1)]: Done 300 out of 300 | elapsed:   22.5s finished

    GridSearchCV(estimator=KNeighborsClassifier(n_neighbors=1), n_jobs=-1,
                 param_grid=[{'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                              'weights': ['uniform']},
                             {'n_neighbors': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
                              'p': [1, 2, 3, 4, 5], 'weights': ['distance']}],
                 verbose=2)



搜索 60 candidates（60 种）的情况。

## 更多的距离定义

- 向量空间余弦相似度 Cosine Similarity
- 调整余弦相似度 Adjusted Cosine Similarity
- 皮尔森相关系数 Pearson Correlation Coefficient
- Jaccard 相似系数 jaccard Coefficient

参考 sklearn 文档

